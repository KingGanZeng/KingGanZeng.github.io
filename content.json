{"meta":{"title":"KingGanZeng`s blogs","subtitle":"Stay hungryï¼Œstay foolish","description":null,"author":"Knight Zeng","url":"http://yoursite.com"},"pages":[],"posts":[{"title":"åŸºäºExpressæ¡†æ¶çš„å›¾ç‰‡å‹ç¼©ä¸Šä¼ ","slug":"åŸºäºExpressæ¡†æ¶çš„å›¾ç‰‡å‹ç¼©ä¸Šä¼ ","date":"2018-05-07T05:11:15.238Z","updated":"2018-05-08T05:53:34.258Z","comments":true,"path":"åŸºäºExpressæ¡†æ¶çš„å›¾ç‰‡å‹ç¼©ä¸Šä¼ /","link":"","permalink":"http://yoursite.com/åŸºäºExpressæ¡†æ¶çš„å›¾ç‰‡å‹ç¼©ä¸Šä¼ /","excerpt":"åœ¨ç½‘ä¸ŠæŸ¥çœ‹äº†å¾ˆå¤šæŠ€æœ¯æ–‡æ¡£ï¼Œä¹Ÿé˜…è¯»äº†Expresså®˜æ–¹çš„æŠ€æœ¯æ–‡æ¡£ï¼Œå¾ˆå¤šåœ¨è¿è¡Œä¸Šéƒ½å¤šå°‘ä¼šæœ‰ä¸€äº›é—®é¢˜ï¼Œæ‰€ä»¥å†³å®šä»Šå¤©æŠŠç¨‹åºä»åˆ›å»ºåˆ°è¿è¡Œå®Œæ•´çš„è®°å½•ä¸‹æ¥ï¼Œæ–¹ä¾¿å‚è€ƒã€‚å…¶ä¸­ç¬¬ä¸‰éƒ¨åˆ†ä½¿ç”¨äº†canvasçš„å›¾ç‰‡å‹ç¼©ï¼Œå¦‚æœä½ åªéœ€è¦å‹ç¼©éƒ¨åˆ†çš„ä»£ç è¯´æ˜ï¼Œå¯ä»¥ç›´æ¥è·³è‡³ç¬¬ä¸‰éƒ¨åˆ†ã€‚ ä¸€ã€è¿è¡Œç¯å¢ƒåŠåŸºæœ¬é…ç½®è¯´æ˜ï¼šâ€‹ phpstorm 2018.1ç‰ˆæœ¬ â€‹ nodejs 8.11.1ç‰ˆæœ¬ â€‹ Express 4.16.0ç‰ˆæœ¬","text":"åœ¨ç½‘ä¸ŠæŸ¥çœ‹äº†å¾ˆå¤šæŠ€æœ¯æ–‡æ¡£ï¼Œä¹Ÿé˜…è¯»äº†Expresså®˜æ–¹çš„æŠ€æœ¯æ–‡æ¡£ï¼Œå¾ˆå¤šåœ¨è¿è¡Œä¸Šéƒ½å¤šå°‘ä¼šæœ‰ä¸€äº›é—®é¢˜ï¼Œæ‰€ä»¥å†³å®šä»Šå¤©æŠŠç¨‹åºä»åˆ›å»ºåˆ°è¿è¡Œå®Œæ•´çš„è®°å½•ä¸‹æ¥ï¼Œæ–¹ä¾¿å‚è€ƒã€‚å…¶ä¸­ç¬¬ä¸‰éƒ¨åˆ†ä½¿ç”¨äº†canvasçš„å›¾ç‰‡å‹ç¼©ï¼Œå¦‚æœä½ åªéœ€è¦å‹ç¼©éƒ¨åˆ†çš„ä»£ç è¯´æ˜ï¼Œå¯ä»¥ç›´æ¥è·³è‡³ç¬¬ä¸‰éƒ¨åˆ†ã€‚ ä¸€ã€è¿è¡Œç¯å¢ƒåŠåŸºæœ¬é…ç½®è¯´æ˜ï¼šâ€‹ phpstorm 2018.1ç‰ˆæœ¬ â€‹ nodejs 8.11.1ç‰ˆæœ¬ â€‹ Express 4.16.0ç‰ˆæœ¬ äºŒã€é¡¹ç›®åˆ›å»ºåŠæ¡†æ¶çš„æ­å»ºâ€‹ é¦–å…ˆæˆ‘ä»¬è¿è¡Œphpstormï¼Œå¹¶create new projectï¼š å› ä¸ºæˆ‘æ˜¯åˆå­¦è€…ï¼Œå¯¹äºnodeçš„æ¨¡æ¿éƒ¨ç½²è¿˜ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œæ‰€ä»¥è¿™é‡Œç”¨äº†é™æ€çš„htmlï¼ˆå…¶å®åæ¥éƒ½æŠŠcsså’Œjså†™åœ¨htmlæ–‡æ¡£é‡Œäº†ï¼Œæ‰€ä»¥è¿™ä¸€éƒ¨åˆ†é»˜è®¤å±æ€§ä¹Ÿä¸ä¼šäº§ç”Ÿå½±å“ï¼‰ é¡¹ç›®åˆ›å»ºå¥½ä¹‹åï¼Œæˆ‘ä»¬ä¸»è¦å¯¹ä¸‹é¢ä¸‰ä¸ªæ–‡ä»¶ï¼šindex.htmlã€app.jsä»¥åŠpackage.jsonè¿›è¡Œæ“ä½œï¼š å› ä¸ºä¸Šä¼ æ–‡ä»¶æˆ‘ä»¬éœ€è¦ç”¨åˆ°expressçš„multerä¸­é—´ä»¶ï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿè¦å…ˆé…ç½®å¥½ï¼ˆé»˜è®¤æ˜¯æ²¡æœ‰çš„ï¼‰ï¼Œæ‰“å¼€å‘½ä»¤è¡Œï¼Œè¿›å…¥é¡¹ç›®çš„ç›®å½•ä¸­ï¼š ç„¶åè¾“å…¥ï¼š 1npm install express multer --save ç­‰å¾…å®Œæˆï¼š è¿™æ—¶æˆ‘ä»¬å†å»æŸ¥çœ‹é¡¹ç›®çš„package.jsonæ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„ä¸­é—´ä»¶å·²ç»æ·»åŠ æˆåŠŸï¼š åŸºæœ¬é…ç½®å·²ç»å®Œæˆï¼Œæ¥ä¸‹æ¥å°±æ˜¯ä»£ç ä¸Šåœºã€‚ ä¸‰ã€å›¾ç‰‡å‹ç¼©æ¨¡å—ï¼šè¿™ä¸€éƒ¨åˆ†ä¸ç‰µæ‰¯expressæ¡†æ¶æˆ–è€…nodejsï¼Œä¸ºçº¯htmlå’Œjsçš„canvaså›¾ç‰‡å‹ç¼©ï¼Œå¦‚æœä½ åªéœ€è¦åšè¿™ä¸€éƒ¨åˆ†çš„è¯ï¼Œå¯ä»¥å•ç‹¬ä½¿ç”¨ï¼Œæ— éœ€å‰ä¸¤éƒ¨åˆ†çš„æ“ä½œã€‚ canvasè¿›è¡Œå›¾ç‰‡å‹ç¼©çš„åŸç†ç®€å•æ¥è¯´ï¼Œå°±æ˜¯å°†åŸæ¥çš„å›¾ç‰‡è½¬ä¸ºbase64æ ¼å¼çš„ä»£ç ï¼Œç„¶åé‡æ–°ç»˜åˆ¶åœ¨ç”»å¸ƒä¸Šã€‚å…¶å®ä¹Ÿå¯ä»¥ç†è§£ä¸ºå°†ä¸€å¹…å·¨å¤§çš„å£ç”»ï¼Œé‡æ–°copyåœ¨ä¸€å¼ å°çš„ç”»å¸ƒä¸Šï¼Œå¹¶åˆ é™¤ä¸€äº›ç»†èŠ‚çš„è¿‡ç¨‹ã€‚ é‚£ä¹ˆå…ˆä¸Šæˆ‘ä»¬çš„htmlä»£ç ï¼Œè¿™é‡Œæˆ‘æŠŠcssä¹Ÿå†™è¿›å»äº†ï¼ˆè™½ç„¶è¯´å¹¶æ²¡æœ‰ç”¨ä»€ä¹ˆæ ·å¼ï¼‰ï¼š 123456789101112131415161718192021222324&lt;html&gt;&lt;head&gt; &lt;title&gt;photoâ€”â€”compress&lt;/title&gt; &lt;link rel=\"stylesheet\" href=\"/stylesheets/style.css\"&gt; &lt;style&gt; #modify_img&#123; display: block; width: 300px; height: 300px; background-size: 100% 100%; &#125; &lt;/style&gt;&lt;/head&gt;&lt;body&gt; &lt;div class=\"img_post\"&gt; &lt;img src=\"images\" alt=\"\" id=\"modify_img\"&gt; &lt;input id=\"file\" type=\"file\" accept=\"image/*\"&gt; &lt;button id=\"upload\"&gt;ä¸Šä¼ &lt;/button&gt; &lt;span id=\"progress\"&gt;0%&lt;/span&gt; &lt;/div&gt;&lt;/body&gt; &lt;/html&gt; ä¸‹é¢æ¥é€ä¸€è¯´æ˜ï¼Œdivé‡Œé¢çš„æ ‡ç­¾ï¼š â€œimgâ€ï¼šå¿…è¦ï¼Œä¸»è¦æ˜¯ä¸ºcanvasç”»å¸ƒå›ºå®šä¸€ä¸ªä½ç½®ï¼Œå®ƒå¿…é¡»è®¾ç½®ä¸ºblockæ˜¾ç¤ºï¼Œ åŒæ—¶è®¾ç½®å®½é«˜ï¼Œå…¶ä¸­çš„background-sizeå±æ€§æ˜¯é˜²æ­¢å›¾ç‰‡æœ¬æ¥å°±å¾ˆå°è€Œæ— æ³•å®Œå…¨å æ»¡æ•´ä¸ªæ¡†é€ æˆæ˜¾ç¤ºé”™è¯¯çš„æƒ…å†µã€‚ â€œinputâ€ï¼šå¿…è¦ï¼Œè®¾ç½®idå’Œinputå±æ€§ï¼ŒåŒæ—¶åªå…è®¸é€‰æ‹©å›¾ç‰‡ç±»å‹æ–‡ä»¶ï¼Œåœ¨ç‚¹å‡»é€‰æ‹©å®Œæ–‡ä»¶åï¼Œä¼šè‡ªåŠ¨åœ¨â€imgâ€ä¸­ç”Ÿæˆå‹ç¼©å¥½çš„å›¾ç‰‡ã€‚ â€œbuttonâ€ï¼šå¿…è¦ï¼ˆå¦‚æœä¸éœ€è¦ä¸Šä¼ åŠŸèƒ½å¯å¿½ç•¥ï¼‰ï¼Œç‚¹å‡»æŒ‰é’®å¯ä»¥å°†å‹ç¼©å¥½çš„å›¾ç‰‡ä¸Šä¼ è‡³expressæœåŠ¡å™¨ï¼ŒåŒæ—¶æ§åˆ¶å°ä¼šè¿”å›ç›¸å…³ä¿¡æ¯ã€‚ â€œspanâ€ï¼šä¸å¿…è¦ï¼Œä¸»è¦æ˜¯ä¸ºäº†æ˜¾ç¤ºä¸Šä¼ è¿›åº¦ã€‚ æ¥ä¸‹æ¥æ˜¯canvasç»˜å›¾çš„ä»£ç ï¼Œå› ä¸ºå†™çš„æ—¶å€™å·²ç»æ³¨é‡Šå¥½äº†ï¼Œåé¢å°±ä¸å†é€ä¸€èµ˜è¿°ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152var getfile = document.querySelector('#file'); //è·å–æ–‡ä»¶ä¸­idä¸ºfileçš„å…ƒç´  var reader = new FileReader(); //FileReaderå¯¹è±¡å…è®¸WEBåº”ç”¨ç¨‹åºå¼‚æ­¥è¯»å–å­˜å‚¨åœ¨ç”¨æˆ·è®¡ç®—æœºä¸Šçš„æ–‡ä»¶ var img = new Image(); //ImageåŠŸèƒ½ç­‰ä»·äº document.createElement('img') var file = null; var canvas = document.createElement('canvas'); var context = canvas.getContext('2d'); //è¿”å›ä¸€ä¸ªç”¨äºåœ¨ç”»å¸ƒä¸Šç»˜å›¾çš„ç¯å¢ƒï¼Œç›®å‰å”¯ä¸€åˆæ³•å€¼ä¸ºâ€œ2dâ€ var newUrl = null;//å¯¹inputç»‘å®šäº‹ä»¶ç›‘å¬ï¼Œå½“å†…å®¹æ”¹å˜æ—¶è§¦å‘ getfile.addEventListener('change', function(event)&#123; file = event.target.files[0]; if ( file.type.indexOf(\"image\") == 0 )&#123; reader.readAsDataURL(file); &#125; &#125;)ï¼› reader.onload = function(e)&#123; //å½“æ–‡ä»¶ä¸Šä¼ å®Œåè§¦å‘ï¼Œä¸»è¦æ˜¯ä¸ºäº†è·å–æºæ–‡ä»¶çš„é•¿å®½ img.src = e.target.result; &#125;; img.onload = function()&#123; //åœ¨å›¾ç‰‡åŠ è½½å®Œæˆåç«‹å³å‘ç”Ÿ var orgin_width = this.width; var orgin_height = this.height; var max_width = 300; var max_height = 300; var target_width = orgin_width; var target_height= orgin_height; if (orgin_width &gt; max_width || orgin_height &gt; max_height)&#123; //åˆ¤æ–­å›¾åƒæ˜¯å¦å¤§äºé™å®šçš„æœ€å¤§é•¿å®½ if (orgin_width / orgin_height &gt; max_width / max_height)&#123; //ä¸Šä¼ å›¾åƒçš„å®½é«˜æ¯”è¾ƒå¤§ï¼Œä»¥å®½ä¸ºé•¿è½´å¯¹é«˜è¿›è¡Œæ‹‰ä¼¸ target_width = max_width; target_height = Math.round(max_width * ( orgin_height / orgin_width )); //roundï¼ˆï¼‰æ–¹æ³•è¡¨ç¤ºå››èˆäº”å…¥å–æ•´æ•° &#125; else &#123; target_width = Math.round(max_height * ( orgin_width / orgin_height )); //é«˜å®½æ¯”è¾ƒå¤§ï¼Œä»¥é«˜ä¸ºé•¿è½´ï¼Œå¯¹å®½è¿›è¡Œç¼©çŸ­ target_height = max_height; &#125; &#125; canvas.width = target_width; canvas.height = target_height; //å¦‚æœæ˜¯pngè½¬jpgå¦‚æœcanvaså­˜åœ¨é€æ˜åŒºåŸŸï¼Œå®é™…ç»˜åˆ¶å‡ºæ¥ä¼šå˜ä¸ºé»‘è‰²ï¼Œå› ä¸ºcanvasé»˜è®¤ä¸ºrgba(0,0,0,0) //åœ¨è½¬æˆjpgçš„æ—¶å€™å˜æˆäº†rgba(0,0,0,1),è§£å†³åŠæ³•å°±æ˜¯åœ¨ç»˜åˆ¶ä¹‹å‰ä¸ºcanvasé“ºä¸Šä¸€å±‚ç™½è‰²çš„åº•è‰² context.fillStyle = \"#FFF\"; context.fillRect(0, 0, target_width, target_height); //ç»˜åˆ¶å·²å¡«å……çŸ©å½¢ //context.clearRect(0, 0, target_width, target_height); //æ¸…é™¤ç”»å¸ƒå¹¶è®¾ç½®å®½é«˜ context.drawImage(img, 0, 0, target_width, target_height); //ç»˜ç”» newUrl = canvas.toDataURL('image/jpeg', 0.92); //base64 æ ¼å¼ modify_img.style.backgroundImage='url(' + newUrl + ')'; &#125;; è®¾ç½®å¥½åç‚¹å‡»å³ä¸Šè§’çš„chromeè¿›è¡Œæµ‹è¯•: é¡µé¢æ˜¾ç¤ºå¦‚ä¸‹ï¼ˆè¯·æ— è§†é‚£ä¸ªbuttonçš„ä¹±ç ï¼Œè¿‡ä¼šæˆ‘ä»¬ç”¨æœåŠ¡å™¨è¿›è¡Œæµ‹è¯•å°±æ­£å¸¸äº†ï¼‰: ä¸ºäº†æµ‹è¯•ï¼Œæˆ‘é€‰æ‹©äº†ä¸€å¼ 1.3Mçš„ç…§ç‰‡ï¼š ç‚¹å‡»æ‰“å¼€åï¼Œå›¾ç‰‡ä¼šè¿›è¡Œå‹ç¼©ï¼Œç„¶åæ˜¾ç¤ºåœ¨â€imgâ€æ ‡ç­¾é‡Œï¼Œå¯ä»¥æ˜æ˜¾çš„é€šè¿‡å›¾ç‰‡çš„é”¯é½¿æ„Ÿçœ‹å‡ºå›¾ç‰‡å·²ç»è¿›è¡Œäº†å‹ç¼©ï¼š è¿™æ—¶å€™å¦‚æœæˆ‘ä»¬å»æ£€æŸ¥æ–‡æ¡£ï¼Œä¼šå‘ç°å›¾ç‰‡å·²ç»è¢«è½¬ä¸ºäº†base64ç¼–ç ï¼š åˆ°æ­¤ï¼Œæˆ‘ä»¬çš„canvaså·²ç»é¡ºåˆ©å®Œæˆäº†å›¾ç‰‡çš„å‹ç¼©å·¥ä½œï¼Œæ¥ä¸‹æ¥å°±æ˜¯æœåŠ¡å™¨ä¸Šåœºã€‚ å››ã€åˆ©ç”¨Expressçš„multerä¸­é—´ä»¶å®ç°æ–‡ä»¶ä¸æœåŠ¡å™¨çš„äº¤äº’å½“æ—¶åœ¨åšè¿™ä¸€éƒ¨åˆ†çš„æ—¶å€™èµ°äº†å¾ˆå¤šå¼¯è·¯ï¼Œå› ä¸ºexpress4.xå·²ç»ä¸å†åŒ…æ‹¬body-parserï¼Œéœ€è¦è‡ªå·±è¿›è¡Œç›¸å…³é…ç½®ï¼Œæå¾—å¾ˆå¤´ç—›ã€‚åæ¥å‘ç°åˆ°æœ€æ–°çš„expresså·²ç»ä¸ºæˆ‘ä»¬æä¾›äº†multerè¿™ä¸ªä¸­é—´ä»¶ï¼Œæ–¹ä¾¿äº†ä¸å°‘ï¼Œæ¥ä¸‹æ¥å…ˆä¸Šjsçš„ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738var upload = document.querySelector('#upload'); //ä¸º\"ä¸Šä¼ \"æŒ‰é’®ç»‘å®šå˜é‡ var progress = document.querySelector('#progress'); //ä¸ºè¿›åº¦æ¡ç»‘å®šå˜é‡ var xhr = new XMLHttpRequest(); //å®šä¹‰xhr upload.addEventListener('click', uploadFile, false); //è®¾ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶ function uploadFile(event)&#123; function dataURLtoFile(dataurl, filename) &#123; //å°†æˆ‘ä»¬ä¸Šé¢è½¬æ¢çš„base64æ ¼å¼ç¼–ç è½¬ä¸ºæ–‡ä»¶ç±»å‹ var arr = dataurl.split(','), mime = arr[0].match(/:(.*?);/)[1], bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n); while(n--)&#123; u8arr[n] = bstr.charCodeAt(n); &#125; return new File([u8arr], filename, &#123;type:mime&#125;); &#125; var file_img = dataURLtoFile(newUrl, file.name); //å®šä¹‰æ–‡ä»¶ç±»å‹çš„å›¾ç‰‡ var formData = new FormData(); //å®šä¹‰formdataçš„å¤„ç†æ–¹æ³• formData.append('test-upload', file_img); //å®šä¹‰å¤„ç†åŸŸä»¥åŠæ–‡ä»¶ä¼ å…¥ xhr.onload = uploadSuccess; //ä¸Šè½½æˆåŠŸçš„è¿”å›å‡½æ•° xhr.upload.onprogress = setProgress; //å¤„ç†è¿›åº¦çš„æ”¾å›å‡½æ•° xhr.open('post', '/upload', true); //ajaxæ•°æ®è¯·æ±‚æ–¹æ³• xhr.send(formData); //ajaxæ•°æ®å‘é€æ–¹æ³• &#125; function uploadSuccess(event)&#123; if(xhr.readyState === 4)&#123; console.log(xhr.responseText); &#125; &#125; function setProgress(event) &#123; if (event.lengthComputable) &#123; var complete = Number.parseInt(event.loaded / event.total * 100); progress.innerHTML = complete + '%'; &#125; &#125; è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ 123...var file_img = dataURLtoFile(newUrl, file.name); //å®šä¹‰æ–‡ä»¶ç±»å‹çš„å›¾ç‰‡... ç¬¬äºŒä¸ªå‚æ•°file.nameä¸­ï¼Œfileä¸ºç¬¬ä¸‰éƒ¨åˆ†ä¸­å®šä¹‰è¿‡çš„fileï¼Œç›®çš„æ˜¯ä¸ºäº†ä¼ å…¥å‹ç¼©è¿‡çš„æ–‡ä»¶åç§°ï¼Œå¦‚æœéœ€è¦ä¿®æ”¹è¯·å°†dataURLtoFile()å‡½æ•°ä¸€å¹¶ä¿®æ”¹ã€‚ ç„¶åæˆ‘ä»¬éœ€è¦å¯¹expressè¿›è¡Œä¸€äº›é…ç½®ï¼Œåœ¨ç¬¬äºŒéƒ¨åˆ†æˆ‘ä»¬å·²ç»å¼•å…¥ä¸­é—´ä»¶ï¼Œé‚£ä¹ˆåªéœ€è¦åœ¨app.jsä¸­è¿›è¡Œå¼•å…¥ã€‚é¦–å…ˆåœ¨æ–‡ä»¶å¤´å®šä¹‰ä¸Šä¼ å’Œæ–‡ä»¶è¿™ä¸¤ä¸ªå˜é‡ï¼Œæ–¹ä¾¿æˆ‘ä»¬ä½¿ç”¨ï¼Œå¹¶è®¾ç½®å¥½ç«¯å£å·ï¼š(çœç•¥å·ä¹‹é—´çš„ä¸ºæ–°å†™å…¥çš„å†…å®¹ï¼ï¼ï¼) 1234567var logger = require('morgan');//...var upload = require('multer')(&#123; dest: 'uploads/' &#125;); //ä¸Šä¼ å›¾ç‰‡ä¿å­˜çš„æ–‡ä»¶å¤¹ä¸ºuploadsvar fs = require('fs');var port = 8000;//...var indexRouter = require('./routes/index'); æ¥ä¸‹æ¥å®šä¹‰æ–‡ä»¶çš„ä¸Šä¼ è¾“å‡ºä¿¡æ¯ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243app.use('/users', usersRouter);//...app.set('port', port);app.get('*', (req, res) =&gt; &#123; res.redirect('index.html');&#125;);app.post('/upload', upload.single('test-upload'), (req, res) =&gt; &#123; // æ²¡æœ‰é™„å¸¦æ–‡ä»¶ if (!req.file) &#123; res.json(&#123; ok: false &#125;); return; &#125; // è¾“å‡ºæ–‡ä»¶ä¿¡æ¯ console.log('===================================================='); console.log('fieldname: ' + req.file.fieldname); console.log('originalname: ' + req.file.originalname); console.log('encoding: ' + req.file.encoding); console.log('mimetype: ' + req.file.mimetype); console.log('size: ' + (req.file.size / 1024).toFixed(2) + 'KB'); console.log('destination: ' + req.file.destination); console.log('filename: ' + req.file.filename); console.log('path: ' + req.file.path); // é‡å‘½åæ–‡ä»¶ let oldPath = path.join(__dirname, req.file.path); let newPath = path.join(__dirname, 'uploads/' + req.file.originalname); fs.rename(oldPath, newPath, (err) =&gt; &#123; if (err) &#123; res.json(&#123; ok: false &#125;); console.log(err); &#125; else &#123; res.json(&#123; ok: true &#125;); &#125; &#125;);&#125;);app.listen(port, () =&gt; &#123; console.log(\"[Server] localhost:\" + port);&#125;);//...module.exports = app; è‡³æ­¤ï¼Œæˆ‘ä»¬çš„ä¸Šä¼ åŠŸèƒ½ä¹Ÿæ­å»ºå®Œæ¯•ã€‚ äº”ã€ç¨‹åºè¿è¡Œï¼šä¸Šè¿°æ“ä½œå…¨éƒ¨å®Œæˆåï¼Œå› ä¸ºç¼–è¯‘å™¨å·²ç»å¸®æˆ‘ä»¬é…å¥½äº†è¿è¡Œç¯å¢ƒï¼ˆçœŸçš„æ˜¯çœäº†ä¸€å¤§æ­¥çš„äº‹ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ç‚¹å‡»å³ä¸Šè§’çš„ç»¿è‰²å°ç®­å¤´ï¼š è¿è¡Œï¼š è¿™æ—¶æˆ‘ä»¬çš„æœåŠ¡å™¨å·²ç»å¯åŠ¨äº†ï¼Œæ‰“å¼€chromeï¼Œè¾“å…¥http://localhost:8000/ å°±å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„ç•Œé¢äº†ï¼Œç„¶åé€‰æ‹©æ–‡ä»¶åç‚¹å‡»ä¸Šä¼ ï¼Œè¿›åº¦æ˜¾ç¤º100%å°±ä»£è¡¨ä¸Šä¼ æˆåŠŸï¼š æ§åˆ¶å°è¿”å›ç»™æˆ‘ä»¬å›¾ç‰‡çš„ç›¸å…³ä¿¡æ¯ï¼š å¯ä»¥çœ‹åˆ°å›¾ç‰‡ä»1.3Må‹ç¼©åˆ°äº†33.33KBï¼ŒåŒæ—¶å­˜æ”¾è·¯å¾„ä¸ºuploadsçš„æ–‡ä»¶å¤¹ï¼› æ¥ä¸‹æ¥åˆ°æˆ‘ä»¬å®šä¹‰å¥½çš„å­˜å›¾ç‰‡çš„åœ°æ–¹ï¼š ç„¶åï¼Œç„¶åå°±å¼€å¿ƒçš„ç©è¿™ä¸ªä¸œè¥¿äº†ï¼ŒğŸ˜ã€‚ å…¶å®expressä¹Ÿå¯ä»¥é€šè¿‡è£å‰ªçš„æ–¹å¼è¿›è¡Œå›¾ç‰‡å‹ç¼©ï¼Œä¸è¿‡é‚£éœ€è¦ç°å°†æºæ–‡ä»¶ä¸Šä¼ è‡³æœåŠ¡å™¨ï¼ˆè¿˜æ˜¯ä¼šæµªè´¹æµé‡ï¼Œè€Œä¸”åŠ è½½é€Ÿåº¦ä¹Ÿä¼šå—å½±å“ï¼‰ï¼›ä½¿ç”¨canvaså…ˆåœ¨æœ¬åœ°è¿›è¡Œå›¾ç‰‡å‹ç¼©ï¼Œç„¶åä¸Šä¼ æœåŠ¡å™¨ï¼Œè¿™æ˜¯ç›®å‰ä¸»æµçš„åšæ³•ã€‚æœ¬é¡¹ç›®éœ€è¦æ³¨æ„çš„ç‚¹åœ¨äºå‹ç¼©å¥½åçš„å›¾ç‰‡åªæ˜¯å­˜åœ¨çš„æ ‡ç­¾ä¸‹ï¼Œè€Œä¸Šä¼ çš„éœ€è¦æ˜¯æ–‡ä»¶ï¼Œè¿™å°±éœ€è¦ç”¨dataURLtoFile()è¿™ä¸€ä¸ªå‡½æ•°å°†å›¾ç‰‡è¿›è¡Œè½¬åŒ–ï¼Œå†å¯¹æ–‡ä»¶è¿›è¡Œä¸Šä¼ ã€‚å¦åˆ™å°†è¿™ä¸€éƒ¨åˆ†ä»£ç æ”¹ä¸ºï¼š 123...formData.append('test-upload', file); ... ä¸Šä¼ çš„ä»ç„¶æ˜¯æœªè¢«å‹ç¼©çš„æºæ–‡ä»¶ã€‚","categories":[],"tags":[{"name":"Nodejs","slug":"Nodejs","permalink":"http://yoursite.com/tags/Nodejs/"}]},{"title":"node.jséç®¡é“æ–¹æ³•è¯»å†™é”™è¯¯é—®é¢˜","slug":"node.jsä¼ ç»Ÿè¯»å†™æµçš„æ—¶é—´å…ˆåé—®é¢˜","date":"2018-05-04T06:09:17.293Z","updated":"2018-05-08T05:53:39.676Z","comments":true,"path":"node.jsä¼ ç»Ÿè¯»å†™æµçš„æ—¶é—´å…ˆåé—®é¢˜/","link":"","permalink":"http://yoursite.com/node.jsä¼ ç»Ÿè¯»å†™æµçš„æ—¶é—´å…ˆåé—®é¢˜/","excerpt":"ä»Šå¤©åœ¨å­¦ä¹ node.jsæµçš„æ—¶å€™ï¼Œå‚ç…§èœé¸Ÿæ•™ç¨‹çš„æ–‡æ¡£å†™äº†ä»æµä¸­è¯»å–å’Œå†™å…¥æ•°æ®çš„æ“ä½œï¼Œä½†æ˜¯åœ¨ä¸¤è€…åŒæ—¶è¿è¡Œçš„æ—¶å€™ï¼Œå´å‘ç°å†™å…¥æ–‡æ¡£å¹¶æ²¡æœ‰ä»»ä½•æ•°æ®å†™å…¥ã€‚ å…ˆä¸Šæœ€åˆçš„é”™è¯¯ä»£ç ï¼š","text":"ä»Šå¤©åœ¨å­¦ä¹ node.jsæµçš„æ—¶å€™ï¼Œå‚ç…§èœé¸Ÿæ•™ç¨‹çš„æ–‡æ¡£å†™äº†ä»æµä¸­è¯»å–å’Œå†™å…¥æ•°æ®çš„æ“ä½œï¼Œä½†æ˜¯åœ¨ä¸¤è€…åŒæ—¶è¿è¡Œçš„æ—¶å€™ï¼Œå´å‘ç°å†™å…¥æ–‡æ¡£å¹¶æ²¡æœ‰ä»»ä½•æ•°æ®å†™å…¥ã€‚ å…ˆä¸Šæœ€åˆçš„é”™è¯¯ä»£ç ï¼š 12345678910111213141516171819202122232425262728293031//å¼•å…¥æµæ¨¡å—var fs = require('fs');var data = '';var readerStream = fs.createReadStream('input.txt');var writerStream = fs.createWriteStream('output.txt'); //å°†æ–‡æ¡£ä»input.txtä¸­è¯»å–å‡ºæ¥å­˜å…¥æµreaderStream.on('data', function(chunk)&#123; console.log(\"1ã€Start:\"); data += chunk;&#125;);readerStream.on('end', function()&#123; console.log(\"2ã€\" + data);&#125;);readerStream.on('error', function(err)&#123; console.log(err.stack);&#125;)ï¼›//ä»æµä¸­è¯»å–æ•°æ®å†™å…¥output.txtwriterStream.write(data, 'UTF8');writerStream.end();writerStream.on('finish', function()&#123; console.log(\"3ã€Write done!\"); console.log(\"4ã€All done!\");&#125;);writerStream.on('err', function(err)&#123; console.log(err.stack);&#125;);console.log(\"5ã€Program Finishedï¼\"); 1Hello world! ç¨‹åºçš„è¿è¡Œç»“æœå¦‚ä¸‹ï¼š 123455ã€Program Finished!1ã€Start:3ã€Write done!4ã€All done!2ã€Hello world! è¿™æ—¶å»æŸ¥çœ‹åŒç›®å½•ä¸‹ç”Ÿæˆçš„output.txtæ˜¯æ²¡æœ‰å†…å®¹çš„ï¼Œæ ¹æ®ä»¥ä¸Šä»£ç ï¼Œæ˜¾ç„¶åœ¨è¿›è¡Œå†™å…¥æ“ä½œæ—¶ï¼Œdataå˜é‡è¿˜æ²¡æœ‰æ•°æ®è¯»å…¥ï¼Œå› æ­¤outputå†™å…¥æ•°æ®ä¸ºç©ºï¼ˆä½ ä¹Ÿå¯ä»¥å°è¯•å®šä¹‰dataä¸ºä¸€ä¸ªå­—ç¬¦ä¸²è¿›è¡Œæµ‹è¯•ï¼‰ã€‚ æ¥ä¸‹æ¥å¯¹å†™å…¥æµï¼ˆwriterStreamï¼‰è®¾å®šä¸€ä¸ªå®šæ—¶å™¨ï¼Œ1ç§’åè¿›è¡Œæ“ä½œï¼Œä¿®æ”¹ä»£ç ä¸ºï¼š 12345678...setTimeout(function()&#123; writerStream.write(data, 'UTF8');&#125;,1000);setTimeout(function()&#123; writeStream.end();&#125;,2000)... è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œåœ¨å¯¹å†™æ“ä½œè®¾ç½®å®šæ—¶å™¨çš„æ—¶å€™ï¼Œéœ€è¦å¯¹endæ–¹æ³•ä¹Ÿè®¾å®šå®šæ—¶å™¨ï¼Œå¹¶ä¸”æ—¶é—´éœ€è¦å¤§äºæˆ‘ä»¬å†™æ“ä½œå®šæ—¶å™¨çš„æ—¶é—´ï¼Œä¸ç„¶ä¼šå‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š 12Error: write after end... æœ€ç»ˆè°ƒè¯•åˆ°ä»¥ä¸‹é˜¶æ®µï¼š 123456789...setTimeout(function()&#123; writerStream.write(data, 'UTF8');&#125;,3);//å®šæ—¶ä¸º2åˆ™æŠ›å‡º'Error: write after end'setTimeout(function()&#123; writeStream.end();&#125;,5)... å¯ä»¥çœ‹åˆ°ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®è‡³å°‘è¦3msï¼ˆå®é™…çš„è¯»å–æ—¶é—´è·Ÿæ–‡ä»¶è·¯å¾„ä»¥åŠå¤§å°æœ‰å…³ï¼‰ï¼Œè€Œç¨‹åºè¯»å–å®Œåªéœ€è¦ä¸åˆ°1msï¼Œæ‰€ä»¥æ‰å‡ºç°äº†æœ€å¼€å§‹å†™å…¥æ•°æ®ä¸ºç©ºçš„bugã€‚è¿™ä¹Ÿä¾§é¢è¯´æ˜äº†node.jsçš„å¼‚æ­¥å¤„ç†æ–¹å¼ã€‚ å½“ç„¶ï¼Œå…¶å®node.jså·²ç»å¸®æˆ‘ä»¬åšå¥½äº†è¿™ä¸€å †ç¹æ‚çš„æ“ä½œï¼Œç®¡é“æµï¼ˆpipeï¼‰å¾ˆå¥½çš„è§£å†³äº†è¿™ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬çš„ä»£ç å¯ä»¥ç®€åŒ–ä¸ºï¼š 1234567var fs = require('fs');var readerStream = fs.createReadStream('input.txt');var writeeStream = fs.createWriteStream('output.txt');readerStream.pipe(writeStream);console.log(\"All done!\"); ä¸Šè¿°çš„æ“ä½œä¼šä½¿å¾—output.txtå†…å®¹è¢«è¦†å†™ï¼Œå¦‚æœä½ åªæƒ³åœ¨output.txtä¸­è¿½åŠ å†…å®¹ï¼Œå¯ä»¥åœ¨å®šä¹‰å†™å…¥æµçš„æ—¶å€™è¿½åŠ å‚æ•°: 1var writeeStream = fs.createWriteStream('output.txt',&#123;'flags' : 'a' &#125;); å¯ç”¨çš„å‚æ•°åˆ—è¡¨å¦‚ä¸‹ï¼š flag è¯´æ˜ r è¯»å–æ–‡ä»¶ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨åˆ™æŠ›å‡ºå¼‚å¸¸ r+ è¯»å–å¹¶å†™å…¥ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨æ—¶æŠ›å‡ºå¼‚å¸¸ rs ä»¥åŒæ­¥æ–¹å¼è¯»å–æ–‡ä»¶å¹¶é€šçŸ¥æ“ä½œç³»ç»Ÿå¿½ç•¥æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ w å†™å…¥æ–‡ä»¶ã€‚æ–‡ä»¶ä¸å­˜åœ¨åˆ™åˆ›å»ºè¯¥æ–‡ä»¶ï¼Œå­˜åœ¨åˆ™æ¸…ç©ºæ–‡ä»¶å†…å®¹ w+ è¯»å–å¹¶å†™å…¥æ–‡ä»¶ã€‚æ–‡ä»¶ä¸å­˜åœ¨åˆ™åˆ›å»ºè¯¥æ–‡ä»¶ï¼Œå­˜åœ¨åˆ™æ¸…ç©ºæ–‡ä»¶å†…å®¹ wx ä½œç”¨ä¸â€wâ€ç±»ä¼¼ã€‚ä½†ä»¥æ’ä»–æ–¹å¼æ‰“å¼€æ–‡ä»¶ wx+ ä½œç”¨ä¸â€w+â€ç±»ä¼¼ã€‚ä½†ä»¥æ’ä»–æ–¹å¼æ‰“å¼€æ–‡ä»¶ a ä»¥è¿½åŠ æ–¹å¼å†™å…¥æ–‡ä»¶ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨åˆ™åˆ›å»ºè¯¥æ–‡ä»¶ a+ è¯»å–å¹¶ä»¥è¿½åŠ æ–¹å¼å†™å…¥æ–‡ä»¶ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨åˆ™åˆ›å»ºè¯¥æ–‡ä»¶ ax ä½œç”¨ä¸â€aâ€ç›¸ä¼¼ã€‚ä½†ä»¥æ’ä»–æ–¹å¼æ‰“å¼€æ–‡ä»¶ ax+ ä½œç”¨ä¸â€a+â€ç›¸ä¼¼ã€‚ä½†ä»¥æ’ä»–æ–¹å¼æ‰“å¼€æ–‡ä»¶","categories":[],"tags":[{"name":"Nodejs","slug":"Nodejs","permalink":"http://yoursite.com/tags/Nodejs/"}]}]}